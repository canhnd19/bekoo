import{d as A,P as H,y as g,Q as U,A as Q,z as F,o as r,c as l,a as s,v as C,t as I,s as p,F as T,q as w,R as D,S as z,M as K,n as G,f as d,_ as S,J as N,T as b,U as E,e as J}from"./index-DjWCK6UM.js";import{f as P,c as W}from"./timestampConverter-C2RkqK1z.js";import{_ as R}from"./BaseInput-CxSpndbE.js";import{_ as j}from"./BaseIcon.vue_vue_type_script_setup_true_lang-CDeJnoZf.js";/* empty css                 */import"./use-form-item-Dj5ESu78.js";import"./index-C_etuEo6.js";import"./index-Y1_oVHry.js";const X={class:"chat-main"},Y={class:"chat-header"},Z={class:"chat-user-info"},x={class:"relative"},ee={class:"avatar"},se=["src"],te={key:0,class:"absolute bottom-1 right-2 h-2.5 w-2.5 rounded-full bg-green-500"},ae={key:0,class:"status"},ne={class:"info-icon"},oe={class:"message-content"},ie={class:"message-bubble"},re={class:"message-time"},le={class:"message-input-container"},de={class:"message-actions"},ce={class:"action-btn"},ue={class:"action-btn"},me={class:"action-btn"},ve={class:"w-12"},_e=A({__name:"ChatMain",props:H({chat:{},userInfo:{}},{messageSend:{default:"",type:String},messageSendModifiers:{}}),emits:H(["send"],["update:messageSend"]),setup(y,{emit:h}){const c=y,_=h,t=g(null),u=U(y,"messageSend"),v=async()=>{await K(),t.value&&(t.value.scrollTop=t.value.scrollHeight)};return Q(()=>{v()}),F(()=>c.chat.length,()=>{v()}),(i,n)=>{const o=j,k=R;return r(),l("div",X,[s("div",Y,[s("div",Z,[s("div",x,[s("div",ee,[s("img",{src:i.userInfo.linkAvatar||"/images/avatar-user-default.png",alt:"Avatar",class:"rounded-full"},null,8,se)]),i.userInfo.online==="Online"?(r(),l("div",te)):C("",!0)]),s("div",null,[s("h3",null,I(i.userInfo.name),1),i.userInfo.online==="Online"?(r(),l("p",ae,"Đang hoạt động")):C("",!0)])]),s("div",ne,[p(o,{name:"warning"})])]),s("div",{ref_key:"messagesContainer",ref:t,class:"messages-container"},[(r(!0),l(T,null,w(i.chat,e=>(r(),l("div",{key:e.createdAt,class:G(["message",{"user-message":e.createdBy==="Hệ thống","contact-message":e.createdBy==="Người dùng"}])},[s("div",oe,[s("div",ie,I(e.content),1),s("div",re,I(e.createdAt?e.createdAt:("formatRelativeTime"in i?i.formatRelativeTime:d(P))(("convertTimestampToISO"in i?i.convertTimestampToISO:d(W))(e.time))),1)])],2))),128))],512),s("div",le,[s("div",de,[s("button",ce,[p(o,{name:"voice"})]),s("button",ue,[p(o,{name:"image"})]),s("button",me,[p(o,{name:"face"})])]),p(k,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=e=>u.value=e),placeholder:"Type message...",class:"input-message mb-4",onKeydown:n[1]||(n[1]=D(z(e=>_("send"),["prevent"]),["enter"]))},null,8,["modelValue"]),s("div",ve,[s("div",{class:"send-btn",onClick:n[2]||(n[2]=e=>_("send"))},[p(o,{name:"send-message"})])])])])}}}),ge=S(_e,[["__scopeId","data-v-90cd82a9"]]),pe={class:"sidebar"},fe={class:"sidebar-header"},he={class:"avatar-row"},Ie={class:"avatar"},ye=["src"],ke={key:0,class:"absolute bottom-1 right-0 h-2.5 w-2.5 rounded-full bg-green-500"},$e={class:"favorites-list"},be=["onClick"],Ce={class:"relative"},Te={class:"avatar"},we=["src"],Ae={key:0,class:"absolute bottom-1 right-0 h-2.5 w-2.5 rounded-full bg-green-500"},Se={class:"favorite-info"},Be={class:"favorite-name-row"},Me={class:"time"},Oe={class:"last-message"},Ve=A({__name:"ChatSidebar",props:{listUserChat:{},topFavorites:{},isLoading:{type:Boolean},searchQuery:{}},emits:["update:searchQuery","click-user"],setup(y,{emit:h}){const c=y,_=h,t=g(""),u=g("");F(()=>c.listUserChat,n=>{n.length>0&&(u.value=n[0].userId)});const v=n=>{u.value=n.userId,_("click-user",n)},i=n=>n.trim().split(/\s+/).at(-1)||"";return(n,o)=>{const k=R;return r(),l("div",pe,[s("div",fe,[p(k,{"model-value":d(t),"onUpdate:modelValue":o[0]||(o[0]=e=>N(t)?t.value=e:null),class:"input-search mb-4","show-icon":!0,onChange:o[1]||(o[1]=e=>_("update:searchQuery",d(t)))},null,8,["model-value"]),s("div",he,[(r(!0),l(T,null,w(n.topFavorites,e=>(r(),l("div",{key:e.id,class:"relative"},[s("div",Ie,[s("img",{src:e.avatar,alt:"Avatar"},null,8,ye)]),e.online==="Online"?(r(),l("div",ke)):C("",!0)]))),128))])]),s("div",$e,[(r(!0),l(T,null,w(n.listUserChat,e=>(r(),l("div",{key:e.userId,class:G(["favorite-item",{active:e.userId===d(u)}]),onClick:$=>v(e)},[s("div",Ce,[s("div",Te,[s("img",{src:e.urlImage||"/images/avatar-user-default.png",alt:"Avatar"},null,8,we)]),e.online==="Online"?(r(),l("div",Ae)):C("",!0)]),s("div",Se,[s("div",Be,[s("h4",null,I(e.name),1),s("span",Me,I(e.time),1)]),s("p",Oe,I(e.senderId?`${i(e.name)}: ${e.content}`:`Bạn:  ${e.content}`),1)])],10,be))),128))])])}}}),qe=S(Ve,[["__scopeId","data-v-3e0a991b"]]),Le={class:"app-container"},He=A({__name:"MesageView",setup(y){var B,M;const h=g(""),c=g(""),_=g(!1),t=g([]),u=g([]),v=g({id:(B=t.value[0])==null?void 0:B.userId,name:(M=t.value[0])==null?void 0:M.name,linkAvatar:"/images/avatar-user-default.png",online:"Offline"}),i=a=>{const m=b(),f={requestType:"Get-Chat-History",data:{userId:a.userId}};v.value={id:a.userId,name:a.name,linkAvatar:a.urlImage||"/images/avatar-user-default.png",online:a.online},m.send(f)},n=b();let o;Q(()=>{o=n.addListener("message",a=>{var m,f,O,V,q;if(a.message==="Get-All-Chat")t.value=a.value,v.value={id:(m=t==null?void 0:t.value[0])==null?void 0:m.userId,name:(f=t==null?void 0:t.value[0])==null?void 0:f.name,linkAvatar:((O=t==null?void 0:t.value[0])==null?void 0:O.urlImage)||"/images/avatar-user-default.png",online:(V=t==null?void 0:t.value[0])==null?void 0:V.online},n.send({requestType:"Get-Chat-History",data:{userId:(q=t==null?void 0:t.value[0])==null?void 0:q.userId}});else if(a.message==="Get-Chat-History")u.value=a.value;else if(a.message==="Admin-Chat")console.log("Admin message sent:",a);else if(a.message==="Chat"){const L=a.value;L.senderId===v.value.id&&u.value.push({content:L.content,createdBy:"Người dùng",time:new Date().getTime()}),$()}_.value=!1})}),E(()=>{o&&o()});const k=J(()=>t.value.map(a=>({id:a.userId,avatar:a.urlImage||"/images/avatar-user-default.png",online:a.online}))),e=()=>{if(c.value.trim()){const a=b();u.value.push({content:c.value,time:new Date().getTime(),createdBy:"Hệ thống"}),a.send({requestType:"Admin-Chat",data:{toUserId:v.value.id,content:c.value}}),$(),c.value=""}},$=(a="")=>{const m=b();_.value=!0,h.value=a,m.send({requestType:"Get-All-Chat",data:{name:a}})};return $(),(a,m)=>(r(),l("div",Le,[p(qe,{"is-loading":d(_),"list-user-chat":d(t),"top-favorites":d(k),"search-query":d(h),onClickUser:i,"onUpdate:searchQuery":m[0]||(m[0]=f=>$(f))},null,8,["is-loading","list-user-chat","top-favorites","search-query"]),p(ge,{"message-send":d(c),"onUpdate:messageSend":m[1]||(m[1]=f=>N(c)?c.value=f:null),"user-info":d(v),chat:d(u),onSend:e},null,8,["message-send","user-info","chat"])]))}}),Ke=S(He,[["__scopeId","data-v-06daad1f"]]);export{Ke as default};
