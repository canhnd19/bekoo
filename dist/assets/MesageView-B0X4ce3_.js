import{P as me,Q as pe,R as D,S as fe,T as x,U as K,V as R,d as q,b as ge,e as B,y as _,W as he,z as G,A as ee,o as i,c as d,a,f as t,n as k,X as ue,m as C,p as E,L as H,Y as P,v as b,t as S,s as V,Z as ye,r as oe,h as _e,$ as de,g as be,M as Q,a0 as ie,w as Ie,a1 as le,a2 as re,F as j,q as W,_ as se,J,a3 as O,a4 as ke}from"./index-CNo_zFjp.js";import{f as we,c as Te}from"./timestampConverter-C2RkqK1z.js";import{_ as ce}from"./BaseInput-218HlAGK.js";import{u as Se,d as Ae,t as Ce,_ as Ve}from"./BaseIcon.vue_vue_type_script_setup_true_lang-DpLAcS92.js";import{_ as $e}from"./favicon-BHUZcTbH.js";import{U as X,C as Y,I as Z,u as Be,a as Me,b as Ne,c as Ee}from"./use-form-item-toOYdLTX.js";/* empty css                 */import"./index-RHba02_o.js";import"./index-UAJMjOZI.js";const Pe=m=>["",...me].includes(m),Ue=pe({modelValue:{type:[Boolean,String,Number],default:!1},disabled:Boolean,loading:Boolean,size:{type:String,validator:Pe},width:{type:[String,Number],default:""},inlinePrompt:Boolean,inactiveActionIcon:{type:D},activeActionIcon:{type:D},activeIcon:{type:D},inactiveIcon:{type:D},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},beforeChange:{type:fe(Function)},id:String,tabindex:{type:[String,Number]},...Se(["ariaLabel"])}),Le={[X]:m=>x(m)||K(m)||R(m),[Y]:m=>x(m)||K(m)||R(m),[Z]:m=>x(m)||K(m)||R(m)},ve="ElSwitch",He=q({name:ve}),qe=q({...He,props:Ue,emits:Le,setup(m,{expose:M,emit:w}){const c=m,{formItem:p}=Be(),f=Me(),l=ge("switch"),{inputId:r}=Ne(c,{formItemContext:p}),y=Ee(B(()=>c.loading)),u=_(c.modelValue!==!1),g=_(),n=_(),s=B(()=>[l.b(),l.m(f.value),l.is("disabled",y.value),l.is("checked",h.value)]),$=B(()=>[l.e("label"),l.em("label","left"),l.is("active",!h.value)]),A=B(()=>[l.e("label"),l.em("label","right"),l.is("active",h.value)]),U=B(()=>({width:he(c.width)}));G(()=>c.modelValue,()=>{u.value=!0});const v=B(()=>u.value?c.modelValue:!1),h=B(()=>v.value===c.activeValue);[c.activeValue,c.inactiveValue].includes(v.value)||(w(X,c.inactiveValue),w(Y,c.inactiveValue),w(Z,c.inactiveValue)),G(h,e=>{var o;g.value.checked=e,c.validateEvent&&((o=p==null?void 0:p.validate)==null||o.call(p,"change").catch(I=>Ae()))});const N=()=>{const e=h.value?c.inactiveValue:c.activeValue;w(X,e),w(Y,e),w(Z,e),Q(()=>{g.value.checked=h.value})},z=()=>{if(y.value)return;const{beforeChange:e}=c;if(!e){N();return}const o=e();[ie(o),x(o)].includes(!0)||Ce(ve,"beforeChange must return type `Promise<boolean>` or `boolean`"),ie(o)?o.then(T=>{T&&N()}).catch(T=>{}):o&&N()},F=()=>{var e,o;(o=(e=g.value)==null?void 0:e.focus)==null||o.call(e)};return ee(()=>{g.value.checked=h.value}),M({focus:F,checked:h}),(e,o)=>(i(),d("div",{class:k(t(s)),onClick:de(z,["prevent"])},[a("input",{id:t(r),ref_key:"input",ref:g,class:k(t(l).e("input")),type:"checkbox",role:"switch","aria-checked":t(h),"aria-disabled":t(y),"aria-label":e.ariaLabel,name:e.name,"true-value":e.activeValue,"false-value":e.inactiveValue,disabled:t(y),tabindex:e.tabindex,onChange:N,onKeydown:ue(z,["enter"])},null,42,["id","aria-checked","aria-disabled","aria-label","name","true-value","false-value","disabled","tabindex","onKeydown"]),!e.inlinePrompt&&(e.inactiveIcon||e.inactiveText)?(i(),d("span",{key:0,class:k(t($))},[e.inactiveIcon?(i(),C(t(P),{key:0},{default:E(()=>[(i(),C(H(e.inactiveIcon)))]),_:1})):b("v-if",!0),!e.inactiveIcon&&e.inactiveText?(i(),d("span",{key:1,"aria-hidden":t(h)},S(e.inactiveText),9,["aria-hidden"])):b("v-if",!0)],2)):b("v-if",!0),a("span",{ref_key:"core",ref:n,class:k(t(l).e("core")),style:_e(t(U))},[e.inlinePrompt?(i(),d("div",{key:0,class:k(t(l).e("inner"))},[e.activeIcon||e.inactiveIcon?(i(),C(t(P),{key:0,class:k(t(l).is("icon"))},{default:E(()=>[(i(),C(H(t(h)?e.activeIcon:e.inactiveIcon)))]),_:1},8,["class"])):e.activeText||e.inactiveText?(i(),d("span",{key:1,class:k(t(l).is("text")),"aria-hidden":!t(h)},S(t(h)?e.activeText:e.inactiveText),11,["aria-hidden"])):b("v-if",!0)],2)):b("v-if",!0),a("div",{class:k(t(l).e("action"))},[e.loading?(i(),C(t(P),{key:0,class:k(t(l).is("loading"))},{default:E(()=>[V(t(ye))]),_:1},8,["class"])):t(h)?oe(e.$slots,"active-action",{key:1},()=>[e.activeActionIcon?(i(),C(t(P),{key:0},{default:E(()=>[(i(),C(H(e.activeActionIcon)))]),_:1})):b("v-if",!0)]):t(h)?b("v-if",!0):oe(e.$slots,"inactive-action",{key:2},()=>[e.inactiveActionIcon?(i(),C(t(P),{key:0},{default:E(()=>[(i(),C(H(e.inactiveActionIcon)))]),_:1})):b("v-if",!0)])],2)],6),!e.inlinePrompt&&(e.activeIcon||e.activeText)?(i(),d("span",{key:1,class:k(t(A))},[e.activeIcon?(i(),C(t(P),{key:0},{default:E(()=>[(i(),C(H(e.activeIcon)))]),_:1})):b("v-if",!0),!e.activeIcon&&e.activeText?(i(),d("span",{key:1,"aria-hidden":!t(h)},S(e.activeText),9,["aria-hidden"])):b("v-if",!0)],2)):b("v-if",!0)],10,["onClick"]))}});var ze=be(qe,[["__file","switch.vue"]]);const Fe=Ie(ze),De={class:"chat-main"},Oe={class:"chat-header"},xe={class:"chat-user-info"},Ge={class:"relative"},Ke={class:"avatar"},Re=["src"],Qe={key:0,class:"absolute bottom-1 right-2 h-2.5 w-2.5 rounded-full bg-green-500"},je={key:0,class:"status"},We={key:1,class:"text-xs text-[var(--placeholder)]"},Je={class:"flex items-center justify-between gap-6"},Xe={class:"flex items-center justify-end gap-6"},Ye={class:"info-icon"},Ze={class:"message-content max-w-[70%]"},es=["src"],ss={class:"message-bubble"},ts={key:1,src:$e,alt:"Avatar",class:"h-10 w-10 rounded-full"},as={class:"message-input-container"},ns={class:"message-actions"},os={class:"action-btn"},is={class:"action-btn"},ls={class:"action-btn"},rs={class:"w-12"},us=q({__name:"ChatMain",props:le({chat:{},userInfo:{},isLoadMore:{type:Boolean},isScrollToTop:{type:Boolean}},{messageSend:{default:"",type:String},messageSendModifiers:{},status:{default:"Admin-on"},statusModifiers:{}}),emits:le(["send","load-more","change-status-ai-auto-reply"],["update:messageSend","update:status"]),setup(m,{expose:M,emit:w}){const c=m,p=w,f=_(null),l=re(m,"messageSend"),r=re(m,"status"),y=async()=>{await Q(),f.value&&(f.value.scrollTop=f.value.scrollHeight)},u=n=>{if(n.includes("phút trước"))return n.split(" ")[0]+"m";if(n.includes("giờ trước"))return n.split(" ")[0]+"h";if(n.includes("Vài giây trước"))return"Online"};ee(()=>{y()}),G(()=>c.chat.length,()=>{var n;if(c.isScrollToTop){const s=((n=f.value)==null?void 0:n.scrollHeight)||0;Q(()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight-s)})}else y()});const g=()=>{const n=f.value;(n==null?void 0:n.scrollTop)===0&&p("load-more")};return M({messagesContainer:f,scrollToBottom:y}),(n,s)=>{const $=Fe,A=Ve,U=ce;return i(),d("div",De,[a("div",Oe,[a("div",xe,[a("div",Ge,[a("div",Ke,[a("img",{src:n.userInfo.linkAvatar||"/images/avatar-user-default.png",alt:"Avatar",class:"rounded-full"},null,8,Re)]),n.userInfo.online==="online"||u(n.userInfo.online)==="online"?(i(),d("div",Qe)):b("",!0)]),a("div",null,[a("h3",null,S(n.userInfo.name),1),n.userInfo.online==="online"?(i(),d("p",je,"Đang hoạt động")):(i(),d("p",We,"hoạt động "+S(n.userInfo.online),1))])]),a("div",Je,[a("div",Xe,[s[5]||(s[5]=a("span",null,"AI auto reply",-1)),V($,{modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=v=>r.value=v),"active-value":"Admin-on","inactive-value":"Admin-off",style:{"--el-switch-on-color":"#129961","--el-switch-off-color":"#c1c4ce"},onChange:s[1]||(s[1]=v=>p("change-status-ai-auto-reply",r.value))},null,8,["modelValue"])]),a("div",Ye,[V(A,{name:"warning"})])])]),a("div",{ref_key:"messagesContainer",ref:f,class:"messages-container",onScroll:g},[(i(!0),d(j,null,W(n.chat,v=>(i(),d("div",{key:v.createdAt,class:k(["message",{"user-message":v.createdBy==="Hệ thống","contact-message":v.createdBy==="Người dùng"}])},[a("div",Ze,[a("div",{class:k(["flex items-start space-x-2",[v.createdBy==="Hệ thống"?"justify-end":"justify-start"]])},[v.createdBy==="Người dùng"?(i(),d("img",{key:0,src:n.userInfo.linkAvatar||"/images/avatar-user-default.png",alt:"Avatar",class:"h-10 w-10 rounded-full"},null,8,es)):b("",!0),a("div",ss,S(v.content),1),v.createdBy==="Hệ thống"?(i(),d("img",ts)):b("",!0)],2),a("div",{class:k(["message-time",[v.createdBy==="Hệ thống"?"mr-12 text-right":"ml-12 text-left"]])},S(v.createdAt?v.createdAt:("formatRelativeTime"in n?n.formatRelativeTime:t(we))(("convertTimestampToISO"in n?n.convertTimestampToISO:t(Te))(v.time))),3)])],2))),128))],544),a("div",as,[a("div",ns,[a("button",os,[V(A,{name:"voice"})]),a("button",is,[V(A,{name:"image"})]),a("button",ls,[V(A,{name:"face"})])]),V(U,{modelValue:l.value,"onUpdate:modelValue":s[2]||(s[2]=v=>l.value=v),placeholder:"Type message...",class:"input-message mb-4",onKeydown:s[3]||(s[3]=ue(de(v=>p("send"),["prevent"]),["enter"]))},null,8,["modelValue"]),a("div",rs,[a("div",{class:"send-btn",onClick:s[4]||(s[4]=v=>p("send"))},[V(A,{name:"send-message"})])])])])}}}),ds=se(us,[["__scopeId","data-v-e0964c2e"]]),cs={class:"sidebar"},vs={class:"sidebar-header"},ms={class:"avatar-row"},ps={class:"avatar"},fs=["src"],gs={key:0,class:"absolute bottom-1 right-0 h-2.5 w-2.5 rounded-full bg-green-500"},hs={key:1,class:"absolute -right-1 bottom-1 rounded-full border border-solid border-green-500 bg-white px-[2px] text-[6px] text-green-500"},ys={class:"favorites-list"},_s=["onClick"],bs={class:"relative"},Is={class:"avatar"},ks=["src"],ws={key:0,class:"absolute bottom-1 right-0 h-2.5 w-2.5 rounded-full bg-green-500"},Ts={key:1,class:"absolute -right-1 bottom-1 rounded-full border border-solid border-green-500 bg-white px-[2px] text-[6px] text-green-500"},Ss={class:"favorite-info"},As={class:"favorite-name-row"},Cs={class:"relative flex flex-col"},Vs={class:"time"},$s={key:0,class:"absolute right-0 top-4 flex h-6 w-6 items-center justify-center rounded-full bg-[#007bff] text-white"},Bs=q({__name:"ChatSidebar",props:{listUserChat:{},topFavorites:{},isLoading:{type:Boolean},searchQuery:{}},emits:["update:searchQuery","click-user"],setup(m,{emit:M}){const w=m,c=M,p=_(""),f=_("");G(()=>w.listUserChat,u=>{u.length>0&&(f.value=u[0].userId)});const l=u=>{f.value=u.userId,c("click-user",u)},r=u=>u.trim().split(/\s+/).at(-1)||"",y=u=>{if(u.includes("phút trước"))return u.split(" ")[0]+"m";if(u.includes("giờ trước"))return u.split(" ")[0]+"h";if(u.includes("Vài giây trước"))return"online"};return(u,g)=>{const n=ce;return i(),d("div",cs,[a("div",vs,[V(n,{"model-value":t(p),"onUpdate:modelValue":g[0]||(g[0]=s=>J(p)?p.value=s:null),class:"input-search mb-4","show-icon":!0,onChange:g[1]||(g[1]=s=>c("update:searchQuery",t(p)))},null,8,["model-value"]),a("div",ms,[(i(!0),d(j,null,W(u.topFavorites,s=>(i(),d("div",{key:s.id,class:"relative"},[a("div",ps,[a("img",{src:s.avatar,alt:"Avatar"},null,8,fs)]),s.online==="online"||y(s.online)==="online"?(i(),d("div",gs)):y(s.online)?(i(),d("p",hs,S(y(s.online)),1)):b("",!0)]))),128))])]),a("div",ys,[(i(!0),d(j,null,W(u.listUserChat,s=>(i(),d("div",{key:s.userId,class:k(["favorite-item",{active:s.userId===t(f)}]),onClick:$=>l(s)},[a("div",bs,[a("div",Is,[a("img",{src:s.urlImage||"/images/avatar-user-default.png",alt:"Avatar"},null,8,ks)]),s.online==="online"||y(s.online)==="online"?(i(),d("div",ws)):y(s.online)?(i(),d("p",Ts,S(y(s.online)),1)):b("",!0)]),a("div",Ss,[a("div",As,[a("h4",null,S(s.name),1),a("p",Cs,[a("span",Vs,S(s.time),1),s.totalUnreadMessages>1&&s.userId!==t(f)?(i(),d("span",$s,S(s.totalUnreadMessages),1)):b("",!0)])]),a("p",{class:k(["last-message",{"font-semibold !text-[#003553]":s.totalUnreadMessages&&s.userId!==t(f)}])},S(s.senderId?`${r(s.name)}: ${s.content}`:`Bạn:  ${s.content}`),3)])],10,_s))),128))])])}}}),Ms=se(Bs,[["__scopeId","data-v-88a45456"]]),Ns={class:"app-container"},Es=q({__name:"MesageView",setup(m){var F,e;const M=_(null),w=_(!1),c=_(""),p=_(""),f=_(!1),l=_(!1),r=_([]),y=_(1),u=_("Admin-on"),g=_([]),n=_({id:(F=r.value[0])==null?void 0:F.userId,name:(e=r.value[0])==null?void 0:e.name,linkAvatar:"/images/avatar-user-default.png",online:"offline"}),s=o=>{const I=O();l.value=!1,g.value=[];const T={requestType:"Get-Chat-History",data:{userId:o.userId,pageIndex:1,pageSize:20}};n.value={id:o.userId,name:o.name,linkAvatar:o.urlImage||"/images/avatar-user-default.png",online:o.online},I.send({requestType:"get-admin-status",data:{toUserId:n.value.id}}),I.send(T)},$=O();let A;ee(()=>{A=$.addListener("message",o=>{var I,T,te,ae,ne;if(o.message==="Get-All-Chat")r.value=o.value,n.value={id:(I=r==null?void 0:r.value[0])==null?void 0:I.userId,name:(T=r==null?void 0:r.value[0])==null?void 0:T.name,linkAvatar:((te=r==null?void 0:r.value[0])==null?void 0:te.urlImage)||"/images/avatar-user-default.png",online:(ae=r==null?void 0:r.value[0])==null?void 0:ae.online},$.send({requestType:"Get-Chat-History",data:{userId:(ne=r==null?void 0:r.value[0])==null?void 0:ne.userId,pageIndex:1,pageSize:20}}),$.send({requestType:"get-admin-status",data:{toUserId:n.value.id}});else if(o.message==="Get-Chat-History"){const L=o.value;y.value===1?g.value=L:(l.value=!0,w.value=!0,g.value=[...L,...g.value],w.value=!1);return}else if(o.message==="Chat"){const L=o.value;L.senderId===n.value.id&&g.value.push({content:L.content,createdBy:"Người dùng",time:new Date().getTime()}),h()}else o.message==="get-admin-status"&&(o.value?u.value="Admin-off":u.value="Admin-on");f.value=!1})}),ke(()=>{A&&A()});const U=B(()=>r.value.map(o=>({id:o.userId,avatar:o.urlImage||"/images/avatar-user-default.png",online:o.online}))),v=()=>{if(p.value.trim()){l.value=!1,y.value=1;const o=O();g.value.push({content:p.value,time:new Date().getTime(),createdBy:"Hệ thống"}),o.send({requestType:"Admin-Chat",data:{toUserId:n.value.id,content:p.value}}),h(),p.value=""}},h=(o="")=>{const I=O();l.value=!1,c.value=o,I.send({requestType:"Get-All-Chat",data:{name:o}})};h();const N=()=>{$.send({requestType:"Get-Chat-History",data:{userId:n.value.id,pageIndex:y.value+1,pageSize:20}}),y.value++},z=()=>{const o=u.value==="Admin-on"?"Admin-off":"Admin-on";$.send({requestType:o,data:{toUserId:n.value.id}})};return(o,I)=>(i(),d("div",Ns,[V(Ms,{"is-loading":t(f),"list-user-chat":t(r),"top-favorites":t(U),"search-query":t(c),onClickUser:s,"onUpdate:searchQuery":I[0]||(I[0]=T=>h(T))},null,8,["is-loading","list-user-chat","top-favorites","search-query"]),V(ds,{ref_key:"messagesContainer",ref:M,"message-send":t(p),"onUpdate:messageSend":I[1]||(I[1]=T=>J(p)?p.value=T:null),status:t(u),"onUpdate:status":I[2]||(I[2]=T=>J(u)?u.value=T:null),"user-info":t(n),chat:t(g),"is-load-more":t(w),"is-scroll-to-top":t(l),onChangeStatusAiAutoReply:z,onSend:v,onLoadMore:N},null,8,["message-send","status","user-info","chat","is-load-more","is-scroll-to-top"])]))}}),xs=se(Es,[["__scopeId","data-v-50a214d7"]]);export{xs as default};
