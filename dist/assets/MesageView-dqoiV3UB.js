import{P as de,Q as ue,R as O,S as ve,T as G,U as Q,V as R,d as q,b as me,e as A,y as b,W as pe,z as K,A as Z,o as t,c as u,a,f as s,n as T,X as ie,m as V,p as N,L as U,Y as E,v as k,t as C,s as $,Z as fe,r as te,h as ge,$ as le,g as he,M as j,a0 as ne,w as ye,a1 as oe,a2 as _e,a3 as F,J as ee,F as W,q as x,_ as se,a4 as be}from"./index-BF8YZsyN.js";import{f as Ie,c as ke}from"./timestampConverter-C2RkqK1z.js";import{_ as re}from"./BaseInput-CySznTaA.js";import{u as we,d as Te,t as Se,_ as Ce}from"./BaseIcon.vue_vue_type_script_setup_true_lang-2reowm3D.js";import{_ as Ve}from"./favicon-BHUZcTbH.js";import{U as J,C as X,I as Y,u as $e,a as Ae,b as Be,c as Me}from"./use-form-item-UeCd67b5.js";/* empty css                 */import"./index-DGKHIVkP.js";import"./index-Co17OX-1.js";const Ne=m=>["",...de].includes(m),Ee=ue({modelValue:{type:[Boolean,String,Number],default:!1},disabled:Boolean,loading:Boolean,size:{type:String,validator:Ne},width:{type:[String,Number],default:""},inlinePrompt:Boolean,inactiveActionIcon:{type:O},activeActionIcon:{type:O},activeIcon:{type:O},inactiveIcon:{type:O},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},beforeChange:{type:ve(Function)},id:String,tabindex:{type:[String,Number]},...we(["ariaLabel"])}),Pe={[J]:m=>G(m)||Q(m)||R(m),[X]:m=>G(m)||Q(m)||R(m),[Y]:m=>G(m)||Q(m)||R(m)},ce="ElSwitch",Le=q({name:ce}),He=q({...Le,props:Ee,emits:Pe,setup(m,{expose:B,emit:w}){const c=m,{formItem:p}=$e(),_=Ae(),r=me("switch"),{inputId:i}=Be(c,{formItemContext:p}),g=Me(A(()=>c.loading)),l=b(c.modelValue!==!1),h=b(),M=b(),n=A(()=>[r.b(),r.m(_.value),r.is("disabled",g.value),r.is("checked",y.value)]),o=A(()=>[r.e("label"),r.em("label","left"),r.is("active",!y.value)]),I=A(()=>[r.e("label"),r.em("label","right"),r.is("active",y.value)]),P=A(()=>({width:pe(c.width)}));K(()=>c.modelValue,()=>{l.value=!0});const S=A(()=>l.value?c.modelValue:!1),y=A(()=>S.value===c.activeValue);[c.activeValue,c.inactiveValue].includes(S.value)||(w(J,c.inactiveValue),w(X,c.inactiveValue),w(Y,c.inactiveValue)),K(y,e=>{var f;h.value.checked=e,c.validateEvent&&((f=p==null?void 0:p.validate)==null||f.call(p,"change").catch(D=>Te()))});const d=()=>{const e=y.value?c.inactiveValue:c.activeValue;w(J,e),w(X,e),w(Y,e),j(()=>{h.value.checked=y.value})},L=()=>{if(g.value)return;const{beforeChange:e}=c;if(!e){d();return}const f=e();[ne(f),G(f)].includes(!0)||Se(ce,"beforeChange must return type `Promise<boolean>` or `boolean`"),ne(f)?f.then(H=>{H&&d()}).catch(H=>{}):f&&d()},v=()=>{var e,f;(f=(e=h.value)==null?void 0:e.focus)==null||f.call(e)};return Z(()=>{h.value.checked=y.value}),B({focus:v,checked:y}),(e,f)=>(t(),u("div",{class:T(s(n)),onClick:le(L,["prevent"])},[a("input",{id:s(i),ref_key:"input",ref:h,class:T(s(r).e("input")),type:"checkbox",role:"switch","aria-checked":s(y),"aria-disabled":s(g),"aria-label":e.ariaLabel,name:e.name,"true-value":e.activeValue,"false-value":e.inactiveValue,disabled:s(g),tabindex:e.tabindex,onChange:d,onKeydown:ie(L,["enter"])},null,42,["id","aria-checked","aria-disabled","aria-label","name","true-value","false-value","disabled","tabindex","onKeydown"]),!e.inlinePrompt&&(e.inactiveIcon||e.inactiveText)?(t(),u("span",{key:0,class:T(s(o))},[e.inactiveIcon?(t(),V(s(E),{key:0},{default:N(()=>[(t(),V(U(e.inactiveIcon)))]),_:1})):k("v-if",!0),!e.inactiveIcon&&e.inactiveText?(t(),u("span",{key:1,"aria-hidden":s(y)},C(e.inactiveText),9,["aria-hidden"])):k("v-if",!0)],2)):k("v-if",!0),a("span",{ref_key:"core",ref:M,class:T(s(r).e("core")),style:ge(s(P))},[e.inlinePrompt?(t(),u("div",{key:0,class:T(s(r).e("inner"))},[e.activeIcon||e.inactiveIcon?(t(),V(s(E),{key:0,class:T(s(r).is("icon"))},{default:N(()=>[(t(),V(U(s(y)?e.activeIcon:e.inactiveIcon)))]),_:1},8,["class"])):e.activeText||e.inactiveText?(t(),u("span",{key:1,class:T(s(r).is("text")),"aria-hidden":!s(y)},C(s(y)?e.activeText:e.inactiveText),11,["aria-hidden"])):k("v-if",!0)],2)):k("v-if",!0),a("div",{class:T(s(r).e("action"))},[e.loading?(t(),V(s(E),{key:0,class:T(s(r).is("loading"))},{default:N(()=>[$(s(fe))]),_:1},8,["class"])):s(y)?te(e.$slots,"active-action",{key:1},()=>[e.activeActionIcon?(t(),V(s(E),{key:0},{default:N(()=>[(t(),V(U(e.activeActionIcon)))]),_:1})):k("v-if",!0)]):s(y)?k("v-if",!0):te(e.$slots,"inactive-action",{key:2},()=>[e.inactiveActionIcon?(t(),V(s(E),{key:0},{default:N(()=>[(t(),V(U(e.inactiveActionIcon)))]),_:1})):k("v-if",!0)])],2)],6),!e.inlinePrompt&&(e.activeIcon||e.activeText)?(t(),u("span",{key:1,class:T(s(I))},[e.activeIcon?(t(),V(s(E),{key:0},{default:N(()=>[(t(),V(U(e.activeIcon)))]),_:1})):k("v-if",!0),!e.activeIcon&&e.activeText?(t(),u("span",{key:1,"aria-hidden":!s(y)},C(e.activeText),9,["aria-hidden"])):k("v-if",!0)],2)):k("v-if",!0)],10,["onClick"]))}});var ze=he(He,[["__file","switch.vue"]]);const Ue=ye(ze),Fe={class:"chat-main"},qe={class:"chat-header"},De={class:"chat-user-info"},Oe={class:"relative"},Ge={class:"avatar"},Ke=["src"],Qe={key:0,class:"absolute bottom-1 right-2 h-2.5 w-2.5 rounded-full bg-green-500"},Re={key:0,class:"status"},je={key:1,class:"text-xs text-[var(--placeholder)]"},We={class:"flex items-center justify-between gap-6"},xe={class:"flex items-center justify-end gap-6"},Je={class:"info-icon"},Xe={class:"message-content max-w-[70%]"},Ye=["src"],Ze={class:"message-bubble"},es={key:1,src:Ve,alt:"Avatar",class:"h-10 w-10 rounded-full"},ss={class:"message-input-container"},as={class:"message-actions"},ts={class:"action-btn"},ns={class:"action-btn"},os={class:"action-btn"},is={class:"w-12"},ls=q({__name:"ChatMain",props:oe({chat:{},userInfo:{},isLoadMore:{type:Boolean},isScrollToTop:{type:Boolean}},{messageSend:{default:"",type:String},messageSendModifiers:{}}),emits:oe(["send","load-more"],["update:messageSend"]),setup(m,{expose:B,emit:w}){const c=m,p=w,_=b(null),r=_e(m,"messageSend"),i=b("Admin-on"),g=async()=>{await j(),_.value&&(_.value.scrollTop=_.value.scrollHeight)},l=o=>{if(o.includes("phút trước"))return o.split(" ")[0]+"m";if(o.includes("giờ trước"))return o.split(" ")[0]+"h";if(o.includes("Vài giây trước"))return"Online"};Z(()=>{g()}),K(()=>c.chat.length,()=>{var o;if(c.isScrollToTop){const I=((o=_.value)==null?void 0:o.scrollHeight)||0;j(()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight-I)})}else g()});const h=F(),M=()=>{h.send({requestType:i.value,data:{toUserId:c.userInfo.id}})},n=()=>{const o=_.value;(o==null?void 0:o.scrollTop)===0&&p("load-more")};return B({messagesContainer:_,scrollToBottom:g}),(o,I)=>{const P=Ue,S=Ce,y=re;return t(),u("div",Fe,[a("div",qe,[a("div",De,[a("div",Oe,[a("div",Ge,[a("img",{src:o.userInfo.linkAvatar||"/images/avatar-user-default.png",alt:"Avatar",class:"rounded-full"},null,8,Ke)]),o.userInfo.online==="online"||l(o.userInfo.online)==="online"?(t(),u("div",Qe)):k("",!0)]),a("div",null,[a("h3",null,C(o.userInfo.name),1),o.userInfo.online==="online"?(t(),u("p",Re,"Đang hoạt động")):(t(),u("p",je,"hoạt động "+C(o.userInfo.online),1))])]),a("div",We,[a("div",xe,[I[4]||(I[4]=a("span",null,"AI auto reply",-1)),$(P,{modelValue:s(i),"onUpdate:modelValue":I[0]||(I[0]=d=>ee(i)?i.value=d:null),"active-value":"Admin-on","inactive-value":"Admin-off",style:{"--el-switch-on-color":"#129961","--el-switch-off-color":"#c1c4ce"},onChange:M},null,8,["modelValue"])]),a("div",Je,[$(S,{name:"warning"})])])]),a("div",{ref_key:"messagesContainer",ref:_,class:"messages-container",onScroll:n},[(t(!0),u(W,null,x(o.chat,d=>(t(),u("div",{key:d.createdAt,class:T(["message",{"user-message":d.createdBy==="Hệ thống","contact-message":d.createdBy==="Người dùng"}])},[a("div",Xe,[a("div",{class:T(["flex items-start space-x-2",[d.createdBy==="Hệ thống"?"justify-end":"justify-start"]])},[d.createdBy==="Người dùng"?(t(),u("img",{key:0,src:o.userInfo.linkAvatar||"/images/avatar-user-default.png",alt:"Avatar",class:"h-10 w-10 rounded-full"},null,8,Ye)):k("",!0),a("div",Ze,C(d.content),1),d.createdBy==="Hệ thống"?(t(),u("img",es)):k("",!0)],2),a("div",{class:T(["message-time",[d.createdBy==="Hệ thống"?"mr-12 text-right":"ml-12 text-left"]])},C(d.createdAt?d.createdAt:("formatRelativeTime"in o?o.formatRelativeTime:s(Ie))(("convertTimestampToISO"in o?o.convertTimestampToISO:s(ke))(d.time))),3)])],2))),128))],544),a("div",ss,[a("div",as,[a("button",ts,[$(S,{name:"voice"})]),a("button",ns,[$(S,{name:"image"})]),a("button",os,[$(S,{name:"face"})])]),$(y,{modelValue:r.value,"onUpdate:modelValue":I[1]||(I[1]=d=>r.value=d),placeholder:"Type message...",class:"input-message mb-4",onKeydown:I[2]||(I[2]=ie(le(d=>p("send"),["prevent"]),["enter"]))},null,8,["modelValue"]),a("div",is,[a("div",{class:"send-btn",onClick:I[3]||(I[3]=d=>p("send"))},[$(S,{name:"send-message"})])])])])}}}),rs=se(ls,[["__scopeId","data-v-ec91266f"]]),cs={class:"sidebar"},ds={class:"sidebar-header"},us={class:"avatar-row"},vs={class:"avatar"},ms=["src"],ps={key:0,class:"absolute bottom-1 right-0 h-2.5 w-2.5 rounded-full bg-green-500"},fs={key:1,class:"absolute -right-1 bottom-1 rounded-full border border-solid border-green-500 bg-white px-[2px] text-[6px] text-green-500"},gs={class:"favorites-list"},hs=["onClick"],ys={class:"relative"},_s={class:"avatar"},bs=["src"],Is={key:0,class:"absolute bottom-1 right-0 h-2.5 w-2.5 rounded-full bg-green-500"},ks={key:1,class:"absolute -right-1 bottom-1 rounded-full border border-solid border-green-500 bg-white px-[2px] text-[6px] text-green-500"},ws={class:"favorite-info"},Ts={class:"favorite-name-row"},Ss={class:"time"},Cs={class:"last-message"},Vs=q({__name:"ChatSidebar",props:{listUserChat:{},topFavorites:{},isLoading:{type:Boolean},searchQuery:{}},emits:["update:searchQuery","click-user"],setup(m,{emit:B}){const w=m,c=B,p=b(""),_=b("");K(()=>w.listUserChat,l=>{l.length>0&&(_.value=l[0].userId)});const r=l=>{_.value=l.userId,c("click-user",l)},i=l=>l.trim().split(/\s+/).at(-1)||"",g=l=>{if(l.includes("phút trước"))return l.split(" ")[0]+"m";if(l.includes("giờ trước"))return l.split(" ")[0]+"h";if(l.includes("Vài giây trước"))return"online"};return(l,h)=>{const M=re;return t(),u("div",cs,[a("div",ds,[$(M,{"model-value":s(p),"onUpdate:modelValue":h[0]||(h[0]=n=>ee(p)?p.value=n:null),class:"input-search mb-4","show-icon":!0,onChange:h[1]||(h[1]=n=>c("update:searchQuery",s(p)))},null,8,["model-value"]),a("div",us,[(t(!0),u(W,null,x(l.topFavorites,n=>(t(),u("div",{key:n.id,class:"relative"},[a("div",vs,[a("img",{src:n.avatar,alt:"Avatar"},null,8,ms)]),n.online==="online"||g(n.online)==="online"?(t(),u("div",ps)):g(n.online)?(t(),u("p",fs,C(g(n.online)),1)):k("",!0)]))),128))])]),a("div",gs,[(t(!0),u(W,null,x(l.listUserChat,n=>(t(),u("div",{key:n.userId,class:T(["favorite-item",{active:n.userId===s(_)}]),onClick:o=>r(n)},[a("div",ys,[a("div",_s,[a("img",{src:n.urlImage||"/images/avatar-user-default.png",alt:"Avatar"},null,8,bs)]),n.online==="online"||g(n.online)==="online"?(t(),u("div",Is)):g(n.online)?(t(),u("p",ks,C(g(n.online)),1)):k("",!0)]),a("div",ws,[a("div",Ts,[a("h4",null,C(n.name),1),a("span",Ss,C(n.time),1)]),a("p",Cs,C(n.senderId?`${i(n.name)}: ${n.content}`:`Bạn:  ${n.content}`),1)])],10,hs))),128))])])}}}),$s=se(Vs,[["__scopeId","data-v-76ddd50a"]]),As={class:"app-container"},Bs=q({__name:"MesageView",setup(m){var d,L;const B=b(null),w=b(!1),c=b(""),p=b(""),_=b(!1),r=b(!1),i=b([]),g=b(1),l=b([]),h=b({id:(d=i.value[0])==null?void 0:d.userId,name:(L=i.value[0])==null?void 0:L.name,linkAvatar:"/images/avatar-user-default.png",online:"offline"}),M=v=>{const e=F();l.value=[];const f={requestType:"Get-Chat-History",data:{userId:v.userId,pageIndex:1,pageSize:20}};h.value={id:v.userId,name:v.name,linkAvatar:v.urlImage||"/images/avatar-user-default.png",online:v.online},e.send(f)},n=F();let o;Z(()=>{o=n.addListener("message",v=>{var e,f,D,H,ae;if(v.message==="Get-All-Chat")i.value=v.value,h.value={id:(e=i==null?void 0:i.value[0])==null?void 0:e.userId,name:(f=i==null?void 0:i.value[0])==null?void 0:f.name,linkAvatar:((D=i==null?void 0:i.value[0])==null?void 0:D.urlImage)||"/images/avatar-user-default.png",online:(H=i==null?void 0:i.value[0])==null?void 0:H.online},n.send({requestType:"Get-Chat-History",data:{userId:(ae=i==null?void 0:i.value[0])==null?void 0:ae.userId,pageIndex:1,pageSize:20}});else if(v.message==="Get-Chat-History"){const z=v.value;g.value===1?l.value=z:(r.value=!0,w.value=!0,l.value=[...z,...l.value],w.value=!1);return}else if(v.message==="Chat"){const z=v.value;z.senderId===h.value.id&&l.value.push({content:z.content,createdBy:"Người dùng",time:new Date().getTime()}),S()}_.value=!1})}),be(()=>{o&&o()});const I=A(()=>i.value.map(v=>({id:v.userId,avatar:v.urlImage||"/images/avatar-user-default.png",online:v.online}))),P=()=>{if(p.value.trim()){r.value=!1,g.value=1;const v=F();l.value.push({content:p.value,time:new Date().getTime(),createdBy:"Hệ thống"}),v.send({requestType:"Admin-Chat",data:{toUserId:h.value.id,content:p.value}}),S(),p.value=""}},S=(v="")=>{const e=F();r.value=!1,c.value=v,e.send({requestType:"Get-All-Chat",data:{name:v}})};S();const y=()=>{n.send({requestType:"Get-Chat-History",data:{userId:h.value.id,pageIndex:g.value+1,pageSize:20}}),g.value++};return(v,e)=>(t(),u("div",As,[$($s,{"is-loading":s(_),"list-user-chat":s(i),"top-favorites":s(I),"search-query":s(c),onClickUser:M,"onUpdate:searchQuery":e[0]||(e[0]=f=>S(f))},null,8,["is-loading","list-user-chat","top-favorites","search-query"]),$(rs,{ref_key:"messagesContainer",ref:B,"message-send":s(p),"onUpdate:messageSend":e[1]||(e[1]=f=>ee(p)?p.value=f:null),"user-info":s(h),chat:s(l),"is-load-more":s(w),"is-scroll-to-top":s(r),onSend:P,onLoadMore:y},null,8,["message-send","user-info","chat","is-load-more","is-scroll-to-top"])]))}}),qs=se(Bs,[["__scopeId","data-v-99142974"]]);export{qs as default};
