import{f as H,c as Q}from"./timestampConverter-C2RkqK1z.js";import{d as A,P as B,y as p,Q as F,A as U,z as M,o as d,c as m,a as e,t as I,s as _,F as $,q as w,R as G,S as R,M as N,n as L,f as r,_ as S,m as O,J as V,T as k,U as z,e as D}from"./index-DSdE6rLa.js";import{_ as q}from"./BaseInput-xLDcLwsO.js";import{_ as K}from"./BaseIcon.vue_vue_type_script_setup_true_lang-BtQU6Rww.js";import{_ as j}from"./BaseLoading-cRRvHy_5.js";/* empty css                 */import"./use-form-item-gQc69dN8.js";import"./index-l8qa4Dhq.js";import"./index-VKLtQylO.js";const E={class:"chat-main"},J={class:"chat-header"},P={class:"chat-user-info"},W={class:"avatar"},X=["src"],Y={class:"info-icon"},Z={class:"message-content"},x={class:"message-bubble"},ee={class:"message-time"},se={class:"message-input-container"},te={class:"message-actions"},ae={class:"action-btn"},ne={class:"action-btn"},oe={class:"action-btn"},ie={class:"w-12"},re=A({__name:"ChatMain",props:B({chat:{},userInfo:{}},{messageSend:{default:"",type:String},messageSendModifiers:{}}),emits:B(["send"],["update:messageSend"]),setup(y,{emit:f}){const c=y,v=f,t=p(null),u=F(y,"messageSend"),g=async()=>{await N(),t.value&&(t.value.scrollTop=t.value.scrollHeight)};return U(()=>{g()}),M(()=>c.chat.length,()=>{g()}),(l,s)=>{const i=K,C=q;return d(),m("div",E,[e("div",J,[e("div",P,[e("div",W,[e("img",{src:l.userInfo.linkAvatar||"/images/avatar-user-default.png",alt:"Avatar",class:"rounded-full"},null,8,X)]),e("div",null,[e("h3",null,I(l.userInfo.name),1),s[3]||(s[3]=e("p",{class:"status"},"Active now",-1))])]),e("div",Y,[_(i,{name:"warning"})])]),e("div",{ref_key:"messagesContainer",ref:t,class:"messages-container"},[(d(!0),m($,null,w(l.chat,n=>(d(),m("div",{key:n.createdAt,class:L(["message",{"user-message":n.createdBy==="Hệ thống","contact-message":n.createdBy==="Người dùng"}])},[e("div",Z,[e("div",x,I(n.content),1),e("div",ee,I(n.createdAt?n.createdAt:("formatRelativeTime"in l?l.formatRelativeTime:r(H))(("convertTimestampToISO"in l?l.convertTimestampToISO:r(Q))(n.time))),1)])],2))),128))],512),e("div",se,[e("div",te,[e("button",ae,[_(i,{name:"voice"})]),e("button",ne,[_(i,{name:"image"})]),e("button",oe,[_(i,{name:"face"})])]),_(C,{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=n=>u.value=n),placeholder:"Type message...",class:"input-message mb-4",onKeydown:s[1]||(s[1]=G(R(n=>v("send"),["prevent"]),["enter"]))},null,8,["modelValue"]),e("div",ie,[e("div",{class:"send-btn",onClick:s[2]||(s[2]=n=>v("send"))},[_(i,{name:"send-message"})])])])])}}}),le=S(re,[["__scopeId","data-v-820a7768"]]),de={class:"sidebar"},ce={class:"sidebar-header"},ue={class:"avatar-row"},me=["src"],ve={class:"favorites-list"},pe=["onClick"],_e={class:"avatar"},ge=["src"],fe={class:"favorite-info"},he={class:"favorite-name-row"},Ie={class:"time"},ye={class:"last-message"},Ce=A({__name:"ChatSidebar",props:{listUserChat:{},topFavorites:{},isLoading:{type:Boolean},searchQuery:{}},emits:["update:searchQuery","click-user"],setup(y,{emit:f}){const c=y,v=f,t=p(""),u=p("");M(()=>c.listUserChat,s=>{s.length>0&&(u.value=s[0].userId)});const g=s=>{u.value=s.userId,v("click-user",s)},l=s=>s.trim().split(/\s+/).at(-1)||"";return(s,i)=>{const C=j,n=q;return d(),m("div",de,[s.isLoading?(d(),O(C,{key:0})):(d(),m($,{key:1},[e("div",ce,[_(n,{"model-value":r(t),"onUpdate:modelValue":i[0]||(i[0]=a=>V(t)?t.value=a:null),class:"input-search mb-4","show-icon":!0,onChange:i[1]||(i[1]=a=>v("update:searchQuery",r(t)))},null,8,["model-value"]),e("div",ue,[(d(!0),m($,null,w(s.topFavorites,a=>(d(),m("div",{key:a.id,class:"avatar"},[e("img",{src:a.avatar,alt:"Avatar"},null,8,me)]))),128))])]),e("div",ve,[(d(!0),m($,null,w(s.listUserChat,a=>(d(),m("div",{key:a.userId,class:L(["favorite-item",{active:a.userId===r(u)}]),onClick:T=>g(a)},[e("div",_e,[e("img",{src:a.urlImage||"/images/avatar-user-default.png",alt:"Avatar"},null,8,ge)]),e("div",fe,[e("div",he,[e("h4",null,I(a.name),1),e("span",Ie,I(a.time),1)]),e("p",ye,I(a.senderId?`${l(a.name)}: ${a.content}`:`Bạn:  ${a.content}`),1)])],10,pe))),128))])],64))])}}}),ke=S(Ce,[["__scopeId","data-v-63014cc6"]]),$e={class:"app-container"},Te=A({__name:"MesageView",setup(y){var a,T;const f=p(""),c=p(""),v=p(!1),t=p([]),u=p([]),g=p({id:(a=t.value[0])==null?void 0:a.userId,name:(T=t.value[0])==null?void 0:T.name,linkAvatar:"/images/avatar-user-default.png"}),l=o=>{const h={requestType:"Get-Chat-History",data:{userId:o.userId}};g.value={id:o.userId,name:o.name,linkAvatar:o.urlImage||"/images/avatar-user-default.png"},k.send(h)};let s;U(()=>{s=k.addListener("message",o=>{o.message==="Get-All-Chat"?(t.value=o.value,g.value={id:t.value[0].userId,name:t.value[0].name,linkAvatar:t.value[0].urlImage||"/images/avatar-user-default.png"},k.send({requestType:"Get-Chat-History",data:{userId:t.value[0].userId}})):o.message==="Get-Chat-History"&&(console.log("object"),u.value=o.value),v.value=!1})}),z(()=>{s&&s()});const i=D(()=>t.value.map(o=>({id:o.userId,avatar:o.urlImage||"/images/avatar-user-default.png"}))),C=()=>{c.value.trim()&&(u.value.push({content:c.value,time:new Date().getTime(),createdBy:"Hệ thống"}),c.value="")},n=(o="")=>{v.value=!0,f.value=o,k.send({requestType:"Get-All-Chat",data:{name:o}})};return n(),(o,h)=>(d(),m("div",$e,[_(ke,{"is-loading":r(v),"list-user-chat":r(t),"top-favorites":r(i),"search-query":r(f),onClickUser:l,"onUpdate:searchQuery":h[0]||(h[0]=b=>n(b))},null,8,["is-loading","list-user-chat","top-favorites","search-query"]),_(le,{"message-send":r(c),"onUpdate:messageSend":h[1]||(h[1]=b=>V(c)?c.value=b:null),"user-info":r(g),chat:r(u),onSend:C},null,8,["message-send","user-info","chat"])]))}}),qe=S(Te,[["__scopeId","data-v-1cfe3dff"]]);export{qe as default};
