import{d as S,P as Q,y as _,Q as U,A as F,z as G,o as r,c as l,a as s,v as C,t as y,s as p,F as T,q as w,R as D,S as z,M as K,n as A,f as d,_ as B,J as N,T as b,U as E,e as J}from"./index-Bl3lm_-m.js";import{f as P,c as W}from"./timestampConverter-C2RkqK1z.js";import{_ as R}from"./BaseInput-sLGaSMVu.js";import{_ as j}from"./BaseIcon.vue_vue_type_script_setup_true_lang-BsQQqcCA.js";/* empty css                 */import"./use-form-item-CAlQj9sr.js";import"./index-sMUt2BKI.js";import"./index-oqhMMcY-.js";const X={class:"chat-main"},Y={class:"chat-header"},Z={class:"chat-user-info"},x={class:"relative"},ee={class:"avatar"},se=["src"],te={key:0,class:"absolute bottom-1 right-2 h-2.5 w-2.5 rounded-full bg-green-500"},ae={key:0,class:"status"},ne={class:"info-icon"},oe={class:"message-content"},ie={class:"message-bubble"},re={class:"message-input-container"},le={class:"message-actions"},de={class:"action-btn"},ce={class:"action-btn"},ue={class:"action-btn"},me={class:"w-12"},ve=S({__name:"ChatMain",props:Q({chat:{},userInfo:{}},{messageSend:{default:"",type:String},messageSendModifiers:{}}),emits:Q(["send"],["update:messageSend"]),setup(I,{emit:h}){const c=I,g=h,t=_(null),u=U(I,"messageSend"),v=async()=>{await K(),t.value&&(t.value.scrollTop=t.value.scrollHeight)};return F(()=>{v()}),G(()=>c.chat.length,()=>{v()}),(i,n)=>{const o=j,k=R;return r(),l("div",X,[s("div",Y,[s("div",Z,[s("div",x,[s("div",ee,[s("img",{src:i.userInfo.linkAvatar||"/images/avatar-user-default.png",alt:"Avatar",class:"rounded-full"},null,8,se)]),i.userInfo.online==="Online"?(r(),l("div",te)):C("",!0)]),s("div",null,[s("h3",null,y(i.userInfo.name),1),i.userInfo.online==="Online"?(r(),l("p",ae,"Đang hoạt động")):C("",!0)])]),s("div",ne,[p(o,{name:"warning"})])]),s("div",{ref_key:"messagesContainer",ref:t,class:"messages-container"},[(r(!0),l(T,null,w(i.chat,e=>(r(),l("div",{key:e.createdAt,class:A(["message",{"user-message":e.createdBy==="Hệ thống","contact-message":e.createdBy==="Người dùng"}])},[s("div",oe,[s("div",ie,y(e.content),1),s("div",{class:A(["message-time",[e.createdBy==="Hệ thống"?"text-right":"text-left"]])},y(e.createdAt?e.createdAt:("formatRelativeTime"in i?i.formatRelativeTime:d(P))(("convertTimestampToISO"in i?i.convertTimestampToISO:d(W))(e.time))),3)])],2))),128))],512),s("div",re,[s("div",le,[s("button",de,[p(o,{name:"voice"})]),s("button",ce,[p(o,{name:"image"})]),s("button",ue,[p(o,{name:"face"})])]),p(k,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=e=>u.value=e),placeholder:"Type message...",class:"input-message mb-4",onKeydown:n[1]||(n[1]=D(z(e=>g("send"),["prevent"]),["enter"]))},null,8,["modelValue"]),s("div",me,[s("div",{class:"send-btn",onClick:n[2]||(n[2]=e=>g("send"))},[p(o,{name:"send-message"})])])])])}}}),ge=B(ve,[["__scopeId","data-v-71f2d7d9"]]),_e={class:"sidebar"},pe={class:"sidebar-header"},fe={class:"avatar-row"},he={class:"avatar"},ye=["src"],Ie={key:0,class:"absolute bottom-1 right-0 h-2.5 w-2.5 rounded-full bg-green-500"},ke={class:"favorites-list"},$e=["onClick"],be={class:"relative"},Ce={class:"avatar"},Te=["src"],we={key:0,class:"absolute bottom-1 right-0 h-2.5 w-2.5 rounded-full bg-green-500"},Ae={class:"favorite-info"},Se={class:"favorite-name-row"},Be={class:"time"},Me={class:"last-message"},Oe=S({__name:"ChatSidebar",props:{listUserChat:{},topFavorites:{},isLoading:{type:Boolean},searchQuery:{}},emits:["update:searchQuery","click-user"],setup(I,{emit:h}){const c=I,g=h,t=_(""),u=_("");G(()=>c.listUserChat,n=>{n.length>0&&(u.value=n[0].userId)});const v=n=>{u.value=n.userId,g("click-user",n)},i=n=>n.trim().split(/\s+/).at(-1)||"";return(n,o)=>{const k=R;return r(),l("div",_e,[s("div",pe,[p(k,{"model-value":d(t),"onUpdate:modelValue":o[0]||(o[0]=e=>N(t)?t.value=e:null),class:"input-search mb-4","show-icon":!0,onChange:o[1]||(o[1]=e=>g("update:searchQuery",d(t)))},null,8,["model-value"]),s("div",fe,[(r(!0),l(T,null,w(n.topFavorites,e=>(r(),l("div",{key:e.id,class:"relative"},[s("div",he,[s("img",{src:e.avatar,alt:"Avatar"},null,8,ye)]),e.online==="Online"?(r(),l("div",Ie)):C("",!0)]))),128))])]),s("div",ke,[(r(!0),l(T,null,w(n.listUserChat,e=>(r(),l("div",{key:e.userId,class:A(["favorite-item",{active:e.userId===d(u)}]),onClick:$=>v(e)},[s("div",be,[s("div",Ce,[s("img",{src:e.urlImage||"/images/avatar-user-default.png",alt:"Avatar"},null,8,Te)]),e.online==="Online"?(r(),l("div",we)):C("",!0)]),s("div",Ae,[s("div",Se,[s("h4",null,y(e.name),1),s("span",Be,y(e.time),1)]),s("p",Me,y(e.senderId?`${i(e.name)}: ${e.content}`:`Bạn:  ${e.content}`),1)])],10,$e))),128))])])}}}),Ve=B(Oe,[["__scopeId","data-v-b6155df7"]]),qe={class:"app-container"},He=S({__name:"MesageView",setup(I){var M,O;const h=_(""),c=_(""),g=_(!1),t=_([]),u=_([]),v=_({id:(M=t.value[0])==null?void 0:M.userId,name:(O=t.value[0])==null?void 0:O.name,linkAvatar:"/images/avatar-user-default.png",online:"Offline"}),i=a=>{const m=b(),f={requestType:"Get-Chat-History",data:{userId:a.userId}};v.value={id:a.userId,name:a.name,linkAvatar:a.urlImage||"/images/avatar-user-default.png",online:a.online},m.send(f)},n=b();let o;F(()=>{o=n.addListener("message",a=>{var m,f,V,q,H;if(a.message==="Get-All-Chat")t.value=a.value,v.value={id:(m=t==null?void 0:t.value[0])==null?void 0:m.userId,name:(f=t==null?void 0:t.value[0])==null?void 0:f.name,linkAvatar:((V=t==null?void 0:t.value[0])==null?void 0:V.urlImage)||"/images/avatar-user-default.png",online:(q=t==null?void 0:t.value[0])==null?void 0:q.online},n.send({requestType:"Get-Chat-History",data:{userId:(H=t==null?void 0:t.value[0])==null?void 0:H.userId}});else if(a.message==="Get-Chat-History")u.value=a.value;else if(a.message==="Admin-Chat")console.log("Admin message sent:",a);else if(a.message==="Chat"){const L=a.value;L.senderId===v.value.id&&u.value.push({content:L.content,createdBy:"Người dùng",time:new Date().getTime()}),$()}g.value=!1})}),E(()=>{o&&o()});const k=J(()=>t.value.map(a=>({id:a.userId,avatar:a.urlImage||"/images/avatar-user-default.png",online:a.online}))),e=()=>{if(c.value.trim()){const a=b();u.value.push({content:c.value,time:new Date().getTime(),createdBy:"Hệ thống"}),a.send({requestType:"Admin-Chat",data:{toUserId:v.value.id,content:c.value}}),$(),c.value=""}},$=(a="")=>{const m=b();g.value=!0,h.value=a,m.send({requestType:"Get-All-Chat",data:{name:a}})};return $(),(a,m)=>(r(),l("div",qe,[p(Ve,{"is-loading":d(g),"list-user-chat":d(t),"top-favorites":d(k),"search-query":d(h),onClickUser:i,"onUpdate:searchQuery":m[0]||(m[0]=f=>$(f))},null,8,["is-loading","list-user-chat","top-favorites","search-query"]),p(ge,{"message-send":d(c),"onUpdate:messageSend":m[1]||(m[1]=f=>N(c)?c.value=f:null),"user-info":d(v),chat:d(u),onSend:e},null,8,["message-send","user-info","chat"])]))}}),ze=B(He,[["__scopeId","data-v-06daad1f"]]);export{ze as default};
